/*! FactoryJS 0.3.3 */
(function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},b=[].slice;define(["underscore","jquery","backbone"],function(c,d,e){var f;return f=function(){function f(a,b){null==b&&(b={}),this.mixins={},this.mixinSettings={},this.tagCbs={},this.tagMap={},this.promises={},this.instances={},this.definitions={},this.define("Base",a),this.baseTags=b.baseTags||[],this.on("create",this.handleCreate,this)}return c.extend(f.prototype,e.Events),f.prototype.define=function(a,b,f){var g,h,i,j,k=this;if(null==f&&(f={}),null!=this.definitions[a]&&!f.override){if(f.silent)return this;throw h="Definition already exists :: "+a+" :: user overide option to ignore",new Error(h)}return null==(j=this.promises)[a]&&(j[a]=d.Deferred()),g={options:f},c.isFunction(b.extend)||(b.extend=e.Model.extend),g.constructor=c.isFunction(b)?b:function(){return c.clone(b)},g.constructor.prototype.__factory=function(){return k},i=[a].concat(f.tags).concat(this.baseTags),g.tags=c.uniq(i).filter(function(a){return!!a}),this.instances[a]=[],c.each(g.tags,function(a){return k.tagMap[a]=k.tagMap[a]||[],k.tagCbs[a]=k.tagCbs[a]||[]}),this.definitions[a]=g,this.trigger("define",a,g,f),this.promises[a].resolve(this,a),this},f.prototype.hasDefinition=function(a){return!!this.definitions[a]},f.prototype.whenDefined=function(a){var b;return null==(b=this.promises)[a]&&(b[a]=d.Deferred()),this.promises[a].promise()},f.prototype.fetchDefinition=function(a){var b,c=this;return b=this.whenDefined(a),require([a],function(b){return c.define(a,b)}),b},f.prototype.extend=function(a,b,d,e){var f,g;if(null==e&&(e={}),f=this.definitions[a],g="Base Class Not Available :: "+a,!f)throw new Error(g);if(g="Invalid Parameter Definition ::\nexpected object ::\ngot "+d.constructor.prototype.toString(),!c.isObject(d))throw new Error(g);return e.tags=[].concat(f.tags,e.tags),this.define(b,f.constructor.extend(d),e)},f.prototype.clone=function(a){var b,d=this;if(b="Invalid Argument :: Expected Factory",!(a instanceof f))throw new Error(b);return c.each(["definitions","mixins","promises"],function(b){return c.defaults(d[b],a[b]),"definitions"===b?c.each(d[b],function(a,c){return d[b][c].constructor.prototype.__factory=function(){return d}}):void 0})},f.prototype.mirror=function(a){var b=this;return this.clone(a),a.on("define",function(a,d,e){return b.define(a,d.constructor,c.extend({silent:!0},e))}),a.on("defineMixin",this.defineMixin,this)},f.prototype.defineMixin=function(a,b,c){var d;if(null==c&&(c={}),null!=this.mixins[a]&&!c.override)throw d="Mixin already defined :: "+a+" :: use override option to ignore",new Error(d);return this.mixins[a]=b,this.mixinSettings[a]=c,this.trigger("defineMixin",a,b,c),this},f.prototype.composeMixinOptions=function(a,b,d){var e,f,g,h,i;null==d&&(d={}),i=this.mixins[b],e=i.mixinOptions||("function"==typeof i.mixconfig?i.mixconfig(d):void 0)||{};for(h in e)g=c.isObject(d[h]||e[h]),f=c.isArray(d[h]||e[h]),(null==d[h]||g!==!1)&&(g&&c.defaults(null!=d[h]?d[h]:d[h]={},e[h]),f&&(null!=d[h]?d[h]:d[h]=[]).concat(e[h]||[]),d[h]=e[h]);return a.mixinOptions=c.defaults(d,e)},f.prototype.composeMixinDependencies=function(a){var b,c,d,e,f;for(null==a&&(a=[]),d=[],e=0,f=a.length;f>e;e++)c=a[e],b=this.mixinSettings[c].mixins||[],d=d.concat(this.composeMixinDependencies(b)),d.push(c);return d},f.prototype.applyMixin=function(b,d){var e,f,g,h;if(b.____mixed||(h=!0,e=!0,b.____mixed=[]),!(a.call(b.____mixed,d)>=0)){if(f=this.mixins[d],g=this.mixinSettings[d],g.tags&&!e&&(b.____tags||(b.____tags=[]),b.____tags=b.____tags.concat(g.tags)),!f)throw new Error("Mixin Not Defined :: "+d);return c.extend(b,c.omit(f,"mixinOptions")),c.isFunction(b.mixinitialize)&&(b.mixinitialize(),b.mixinitialize=function(){}),b.____mixed.push(d),h&&delete b.____mixed,b}},f.prototype.handleMixins=function(a,b){var d=this;return a.____mixed=[],b=c.uniq(this.composeMixinDependencies(b)),c.each(b,function(b){return d.composeMixinOptions(a,b,a.mixinOptions)}),c.each(b,function(b){return d.applyMixin(a,b,a.mixinOptions)}),a.__mixin=c.chain(function(a,b,c){return a.____mixed=[],this.handleMixins(a,[b],c),delete a.____mixed}).bind(this).partial(a).value(),delete a.____mixed},f.prototype.handleInjections=function(a,b){var d=this;return c.each(b,function(b){return a[b]=d.get(b)})},f.prototype.handleCreate=function(a){var b=this;return c.each(a.__tags(),function(d){var e;return null==b.tagCbs[d]&&(b.tagCbs[d]=[]),e=b.tagCbs[d],0!==e.length?c.each(e,function(b){return c.isFunction(b)?b(a):void 0}):void 0})},f.prototype.handleTags=function(a,b,d){var e,f,g=this;return this.instances[a].push(b),f=c.toArray(d).concat(b.____tags||[]),b.____tags&&delete b.____tags,b.__type=function(){return a},b.__tags=function(){return c.toArray(f)},e=[this.instances[a]],c.each(f,function(a){return null==g.tagMap[a]&&(g.tagMap[a]=[]),g.tagMap[a].push(b),e.push(g.tagMap[a])}),b.__factoryMap=function(){return[].slice.call(e)}},f.prototype.get=function(){var a,d,e,f,g,h,i,j,k,l,m,n;if(k=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],h=null!=(n=this.instances)[k]?(n=this.instances)[k]:n[k]=[],g=this.instances[k][0],e=this.definitions[k],i="Invalid Definition :: "+k+" :: not defined",null==e)throw new Error(i);return d=e.constructor,l=e.options||{},m=!!l.singleton,j=l.mixins||[],f=l.injections||[],m&&g?g:(g=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(d,a,function(){}),this.handleMixins(g,j),this.handleInjections(g,f),this.handleTags(k,g,e.tags),c.isFunction(g.constructed)&&g.constructed.apply(g,a),g.__dispose=function(a){return function(){return a.dispose(this)}}(this),this.trigger("create",g),g)},f.prototype.verifyTags=function(b){return c.all(b.__factoryMap(),function(c){return a.call(c,b)>=0})},f.prototype.dispose=function(b){return c.each(b.__factoryMap(),function(c){var d;if(d="Instance Not In Factory :: "+b+" :: disposal failed!",a.call(c,b)<0)throw new Error(d);return c.splice(c.indexOf(b),1)}),this.trigger("dispose",b)},f.prototype.getConstructor=function(a,b){var d;return null==b&&(b=!1),b?this.definitions[a].constructor:(d=c.chain(this.get).bind(this).partial(a).value(),d.prototype=this.definitions[a].constructor.prototype,d)},f.prototype.onTag=function(a,b){var d,e;if(d="Invalid Argument :: "+typeof a+" provided :: expected String",!c.isString(a))throw new Error(d);if(d="Invalid Argument :: "+typeof b+" provided :: expected Function",!c.isFunction(b))throw new Error(d);return c.each(this.tagMap[a],b),null==(e=this.tagCbs)[a]&&(e[a]=[]),this.tagCbs[a].push(b)},f.prototype.offTag=function(a,b){var d,e;if(e="Invalid Argument :: "+typeof a+" provided :: expected String",!c.isString(a))throw new Error(e);if(null!=this.tagCbs[a]){if(!c.isFunction(b))return this.tagCbs[a]=[],void 0;if(d=this.tagCbs[a].indexOf(b),e="Callback Not Found :: "+b+" :: for tag "+a,-1===d)throw new Error(e);return this.tagCbs[a].splice(d,1)}},f.prototype.isType=function(a,b){return a.__type()===b},f.prototype.getType=function(a){return a.__type()},f}()})}).call(this);